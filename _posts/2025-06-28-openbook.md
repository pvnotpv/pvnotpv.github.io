---
title: OpenBook-V2 Deep Diveâ€”How the limit orders are stored in the form of a tree
date: 2025-06-28 
categories: [finance, clob]
pin: true
tags: [radiyum, pumpfun, serum, dex, openbook, clob, critbit-trees]     
description: OpenBook is a decentralized CLOB on Solana and in this series of blog posts we're going to deep dive into the codebase figure out how the incoming orders are stored.
---

So it's been over a few weeks since I've been spending time on this project and figuring out how it works under the hood, but apparently there are no documentations, guides, and absolutely no articles online on going into the technical aspects of this project. So obviously I decided to make one and get more better at rust and finance.

> In this particular blog post, I won't be going into how the order matching works but rather how the orders are stored in the form of a critbit/binary tree, which is the most complex part of the codebase.

Here's a final drawing I've done on the the tree which is filled with orders.

--- 

Every market on the openbook dex has two accounts of the struct "BookSide" which holds the tree root and it's child nodes for both the bid and ask sides.

```rust 
#[account(zero_copy)]
pub struct BookSide {
    pub roots: [OrderTreeRoot; 2],
    pub reserved_roots: [OrderTreeRoot; 4],
    pub reserved: [u8; 256],
    pub nodes: OrderTreeNodes,
}

#[zero_copy]
pub struct OrderTreeNodes {
    pub order_tree_type: u8, // OrderTreeType, but that's not POD
    pub padding: [u8; 3],
    pub bump_index: u32,
    pub free_list_len: u32,
    pub free_list_head: NodeHandle,
    pub reserved: [u8; 512],
    pub nodes: [AnyNode; MAX_ORDERTREE_NODES],
}
```

The nodes array consists of either leaf or inner nodes , where the leaf represents the actual limit order.

(Removed the other parmas which are not needed for the post)

```rust
pub struct LeafNode {
    pub tag: u8,
    pub key: u128,
    pub owner: Pubkey,
    pub quantity: i64,
}

pub struct InnerNode {
    pub tag: u8, 
    pub prefix_len: u32,
    pub key: u128,
    pub children: [NodeHandle; 2],
}

```
